# autosaver r3 （Garechフォーク版）
AviUtlの編集プロジェクトを自動保存します。

拡張編集の自動バックアップと違い、**AviUtl本体側の編集情報 (Curve Editorのベジェ曲線等) も保存することができます。**

## ダウンロード・インストール
https://github.com/Garech-mas/autosaver/releases/latest

上記のリンクにアクセスした後、`autosaver r3_gr_**.zip` からダウンロードできます。

ZIPの中に入っている `autosaver.auf` を、AviUtlと同階層（またはPluginsフォルダ）の中にコピーしてください。

## 注意点
- **AviUtl ver1.10** 以外のバージョンでは動作しません。

- 上手く動作しない場合、Visual C++ 再頒布可能パッケージ **2015-2022 (x86)** をインストールしてください。

  - （下記リンクの **2015-2022** のリンクから確実にダウンロードすることができます。）https://scrapbox.io/aviutl/Visual_C++_%E5%86%8D%E9%A0%92%E5%B8%83%E5%8F%AF%E8%83%BD%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8

## 仕様
下記条件のいずれかを満たしたタイミングで、現在開いている編集プロジェクトの自動保存を実行します。

- 起動時（または前回の自動保存時）から一定時間（デフォルトで1分）が経過し、編集操作をしたとき
- AVI出力やプラグイン出力を行う直前

バックアップファイルは、AviUtlの実行フォルダ内の `autosaver` フォルダに、`.aup_backup` ファイルとして1分間隔で保存されていきます。

AviUtl本体の `表示` -> `autosaverの表示` から設定画面を開くことができ、`バックアップから開く` ボタンでバックアップを復元することができます。


![image](https://github.com/user-attachments/assets/a4107804-9521-4c6f-acdc-975d2e988f44)


### バックアップの間隔(分)
- 読んで字のごとく。1分~10000分まで分単位で設定可能ですが、1分間隔を推奨しています。
- バックアップ自体を無効にすることはできません。

### バックアップの最大数
- 同上。1~1000まで設定可能です。それ以外の値(0や1000以上)を入力すると際限なくバックアップを作成し続けます。
- その時に作成されたバックアップの保存場所内の `.aup_backup` のファイル数を確認しています。

### バックアップの保存場所
- 指定したパスにバックアップファイルを保存します。
- [AviUtlで扱えるファイルのパス](https://scrapbox.io/aviutl/AviUtl%E3%81%A7%E6%89%B1%E3%81%88%E3%82%8B%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E3%83%91%E3%82%B9) に沿っていない保存パスは設定できません。

- `%PROJECTDIR%` のキーワードを最初に入力した場合、現在開いているプロジェクトファイルが保存されているフォルダーを示すことが出来ます。
  - 例えばデータ保存先を `%PROJECTDIR%\autosaver` とすると、プロジェクトファイルの場所が変わるのに合わせて保存先を変えるような使い方ができます。
  - 保存されていない場合はAviUtlの実行フォルダ内の `autosaver` フォルダを示します。
  
- `%PROJECTNAME%` のキーワードを入力した場合、現在開いているプロジェクト名に置き換えることが出来ます。
  - 例えば `autosaver\%PROJECTNAME%` とすると、`autosaver` フォルダ内の各プロジェクト名フォルダごとに分けて管理することができます。
  - バックアップの最大数は各フォルダごとにチェックされます。

## 保存ファイル形式
- 保存時のファイル名の形式を指定します。
- デフォルトでは `(プロジェクト名)_2024-01-02_12-34` のようなファイル名で保存されます。
  - 上記の`%PROJECTNAME%`キーワードが使用可能です。
  - この項目を変更したタイミングで、コンソールウィンドウ(patch.aul機能)に保存ファイル名の例が表示されます。
  - 使用できる日付形式に関しては以下のリンクを参照してください。(ファイル名として使えない文字は `-` に置換されます。)
  - https://cpprefjp.github.io/reference/chrono/format.html

## 方針
- 設定ファイルはプラグインファイルと同階層に `autosaver.json` として保存されます。
  
- このプラグインを入れたということは自動保存をやりたいということなので、無効化の設定は用意していません。
  
- 上書き保存ではなく、新たな編集プロジェクトを作っていく形を取っています。
  
  - 例外発生などで編集プロジェクトが読み込み不能になったとき、過去に戻れなくなるためです。
    
- バックアップファイルは `.aup_backup` という独自規格を取るようにしました。そのため、ドラッグアンドドロップ実行や直接実行などに対応していません。
  
  - 古いバックアップを消去するときに、バックアップファイル以外の `.aup` を消してしまう事を防ぐためです。
 
- どうしても `.aup`でないとダメな方は、 `autosaver.json` の `extension` を変更してください。
    
  - その際、プロジェクトファイルが消えたなどの苦情は一切受け付けないものとします。

## Special Thanks
Original made by ePi5131 https://github.com/ePi5131


## 更新履歴
### r3_gr_4
- 「バックアップから開く」ウィンドウを開いて、そのままプロジェクトを開かなかった場合に意図しない動作となっていたのを修正
### r3_gr_3
- 開発時に入れてたコードが残っていたのを修正
### r3_gr_1
フォーク版初版。
- GUIウィンドウを追加
- バックアップ最大数設定を追加　それに伴いデフォルトのファイル拡張子を `*.aup_backup` に変更
- バックアップ保存場所設定・保存ファイル名形式設定を追加
- デフォルトの保存先を `%PROJECTDIR%\autosaver` から `aviutl.exe直下\autosaver` に変更
- デフォルトの保存間隔を5分から1分に変更
- 出力直前にもバックアップを取るように変更
- 出力ファイル名がUTC基準の時刻になっていた問題を修正

